<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="pdsw.project.persistence.dao.mybatis.mappers.InitiativeMapper">
    
    <resultMap type='Initiative' id='InitiativeResult'>
        <id property='id' column='ID'/>
        <result property='title' column='Title'/>
        <result property='description' column='Description'/> 
        <result property='status' column='Status'/>
        <result property='creationDate' column='CreationDate'/>
        <result property='field' column='Field'/>
        <result property='keyWords' column='KeyWords'/>
        <association property='usuario' javaType='User' resultMap='pdsw.project.persistence.dao.mybatis.mappers.UserMapper.UserResult' columnPrefix='User_'/>
        <collection property='comentarios' ofType="Comment" resultMap='pdsw.project.persistence.dao.mybatis.mappers.CommentMapper.CommentResult' columnPrefix='Comment_'></collection>        
        <collection property='votos' ofType='Vote' resultMap='pdsw.project.persistence.dao.mybatis.mappers.VoteMapper.VoteResult' columnPrefix='Vote_'></collection>
    </resultMap>
    
    <select id="getInitiatives" resultMap="InitiativeResult">
        SELECT 
            I.ID                    as Initiative_ID,            
            I.Title                 as Initiative_Title,
            I.Description           as Initiative_Description,
            I.Status                as Initiative_Status,
            I.CreationDate          as Initiative_CreationDate,
            I.Field                 as Initiative_Field,
            I.KeyWords              as Initiative_KeyWords,
            I.Users_ID              as Initiative_User_ID,
            U.Name                  as User_Name,
            U.Email                 as User_Email,
            U.Area                  as User_Area,
            U.Role                  as User_Role
        FROM Initiative as I, Users as U
        WHERE I.Users_ID = U.ID;
    </select>
    
    <select id="getInitiative" resultMap="InitiativeResult">
        SELECT
            I.ID                    as Initiative_ID,            
            I.Title                 as Initiative_Title,
            I.Description           as Initiative_Description,
            I.Status                as Initiative_Status,
            I.CreationDate          as Initiative_CreationDate,
            I.Field                 as Initiative_Field,
            I.KeyWords              as Initiative_KeyWords
        FROM Initiative as I
        WHERE ID = #{initiative_id};
    </select>
    
    <!--
    <insert parameterType="map" id="addInitiative">
    	INSERT INTO iniciativas values(#{i.id},#{i.estado},#{i.autor.documento},#{i.nombre},#{i.descripcion},#{i.fechaCreacion}, string_to_array(#{i.palabrasClave},','),#{i.area});   	
    </insert>
    -->
  </mapper>

